# Configuration for bsort - Bottle Cap Sorting System

# Data paths
data:
  raw_dir: "data/raw"
  processed_dir: "data/processed"
  train_split: 0.8
  val_split: 0.1
  test_split: 0.1

# Class definitions
classes:
  light_blue: 0
  dark_blue: 1
  others: 2
  names: ["light_blue", "dark_blue", "others"]

# HSV thresholds for auto-labeling
hsv_thresholds:
  # Hue ranges (0-179 in OpenCV)
  blue_hue_min: 90
  blue_hue_max: 130

  # Light blue: high value, moderate saturation
  light_blue:
    saturation_min: 30
    saturation_max: 150
    value_min: 100
    value_max: 255

  # Dark blue: higher saturation, lower value
  dark_blue:
    saturation_min: 80
    saturation_max: 255
    value_min: 40
    value_max: 140

  # Center region for color sampling (to avoid edge artifacts)
  center_crop_ratio: 0.6

# Training configuration
training:
  model: "yolo11n.pt"  # YOLO11 Nano for edge deployment
  input_size: 640  # Can reduce to 416 for speed
  epochs: 100
  batch_size: 16
  patience: 20  # Early stopping

  # Optimization
  optimizer: "AdamW"
  lr0: 0.001  # Initial learning rate
  lrf: 0.01   # Final learning rate factor
  momentum: 0.937
  weight_decay: 0.0005

  # Augmentation (conservative for industrial setting)
  augmentation:
    hsv_h: 0.015  # Hue augmentation
    hsv_s: 0.4    # Saturation
    hsv_v: 0.3    # Value
    degrees: 5.0  # Rotation (minimal - caps are circular)
    translate: 0.1
    scale: 0.3
    flipud: 0.0   # No vertical flip (gravity matters)
    fliplr: 0.5   # Horizontal flip ok
    mosaic: 1.0

  # Device
  device: "cpu"  # Will be CPU on RPi5
  workers: 4

# Export configuration for ONNX
export:
  format: "onnx"
  simplify: true
  opset: 12  # ONNX opset version
  dynamic: false  # Static shape for optimization

  # INT8 Quantization
  quantize: true
  calibration_images: 100  # Number of images for calibration

# Inference configuration
inference:
  # Model
  model_path: "data/models/best.onnx"
  input_size: 640

  # Performance
  conf_threshold: 0.25  # Confidence threshold
  iou_threshold: 0.3    # Lower for touching caps
  max_det: 50           # Max detections per image

  # Multiprocessing
  use_multiprocessing: true
  num_workers: 2  # Camera + Inference processes
  queue_size: 2   # Keep latest frames only

  # Camera (Raspberry Pi Camera Module 3)
  camera:
    resolution: [1280, 720]  # Will be resized to input_size
    framerate: 60
    format: "RGB888"

  # Hardware monitoring
  monitor_temperature: true
  temp_warning_threshold: 75  # Celsius
  temp_critical_threshold: 80

# Weights & Biases configuration
wandb:
  project: "bottle-cap-sorting"
  entity: null  # Set to your W&B username/team
  log_model: true
  log_interval: 10  # Log every N batches

# Logging
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
